<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso Corporativo | Tapia Melendez</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Reutilizamos tu CSS para mantener la identidad -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <style>
        body { 
            background-color: #0f172a; 
            color: white; 
            font-family: 'Montserrat', sans-serif; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
            overflow: hidden; 
        }

        /* --- CORRECCIÓN DE VISIBILIDAD DE INPUTS --- */
        /* Forzamos fondo oscuro y texto blanco puro */
        .form-control { 
            background-color: #0f172a !important; 
            border: 1px solid #475569; 
            color: #ffffff !important; 
        }
        .form-control::placeholder { color: #94a3b8; opacity: 1; }
        .form-control:focus { 
            background-color: #0f172a !important; 
            color: #ffffff !important;
            border-color: #f59e0b; 
            box-shadow: 0 0 0 0.2rem rgba(245, 158, 11, 0.25); 
        }
        /* Hack para quitar el fondo blanco/azul del autocompletado de Chrome */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active{
            -webkit-box-shadow: 0 0 0 30px #0f172a inset !important;
            -webkit-text-fill-color: white !important;
        }
        /* ------------------------------------------ */

        .text-subtitle { color: #cbd5e1 !important; font-size: 0.9rem; }
        
        /* Botón Volver */
        .top-bar { position: absolute; top: 0; width: 100%; padding: 20px; text-align: center; z-index: 10; }
        .btn-back-web { background-color: rgba(30, 58, 138, 0.5); border: 1px solid #1e3a8a; color: white; padding: 10px 30px; border-radius: 50px; text-decoration: none; font-weight: 600; backdrop-filter: blur(5px); }
        .btn-back-web:hover { background-color: #2563eb; color: white; }

        /* Tarjeta */
        .login-card { background-color: #1e293b; border: 1px solid #334155; width: 100%; max-width: 450px; border-radius: 20px; padding: 3rem 2rem; box-shadow: 0 20px 50px rgba(0,0,0,0.5); z-index: 5; }
        
        .btn-access { background-color: #1e3a8a; color: white; width: 100%; padding: 12px; border-radius: 50px; font-weight: 700; border: none; margin-top: 20px; transition: all 0.3s; }
        .btn-access:hover { background-color: #2563eb; letter-spacing: 1px; }

        /* SPLASH SCREEN ESPECÍFICO */
        .splash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #0f172a; z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column; text-align: center;
            transition: opacity 0.5s ease-out;
        }
    </style>
</head>
<body>

    <!-- SPLASH SCREEN 1: ENTRADA (Tu diseño original) -->
    <div id="splash-login" class="splash-overlay">
        <div class="splash-content text-center">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="logo-pulse mb-3" style="max-width: 140px;">
            <h1 class="logo-text">FERRETERÍA <span class="text-accent">TAPIA MELENDEZ</span></h1>
            
            <!-- Texto Personalizado -->
            <p class="loading-text" style="color: white; font-weight: 800; font-size: 1.2rem;">A loguearse estimado...</p>
            
            <div class="loader mx-auto"></div>
        </div>
    </div>

    <!-- SPLASH SCREEN 2: SALIDA (Validando credenciales) -->
    <div id="splash-validando" class="splash-overlay" style="display: none; opacity: 0;">
        <div class="splash-content text-center">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="logo-pulse mb-3" style="max-width: 140px;">
            <h1 class="logo-text">FERRETERÍA <span class="text-accent">TAPIA MELENDEZ</span></h1>
            <p class="loading-text" style="color: white; font-weight: 800; font-size: 1.2rem;">Validando credenciales...</p>
            <div class="loader mx-auto"></div>
        </div>
    </div>

    <!-- Botón Superior -->
    <div class="top-bar">
        <a href="/" class="btn-back-web"><i class="bi bi-arrow-left-circle me-2"></i> VOLVER A LA PÁGINA WEB</a>
    </div>

    <!-- Tarjeta Login -->
    <div class="login-card text-center">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" width="80" class="mb-4">
        
        <!-- CAMBIO REALIZADO: Título Corporativo -->
        <h4 class="fw-bold mb-1 text-white">Ferretería Tapia Meléndez</h4>
        <p class="text-subtitle mb-4">Ingrese sus credenciales corporativas</p>

        {% if error %}
            <!-- Alerta visible -->
            <div class="alert alert-danger py-2 small fw-bold border-danger bg-danger bg-opacity-10 text-danger">
                <i class="bi bi-exclamation-triangle-fill me-1"></i> {{ error }}
            </div>
        {% endif %}

        <form method="POST" id="loginForm">
            <div class="text-start mb-3">
                <label class="fw-bold small ms-1 mb-1 text-accent">Usuario</label>
                <!-- Inputs corregidos -->
                <input type="text" name="username" class="form-control" placeholder="Ingrese su usuario" required>
            </div>

            <div class="text-start mb-4">
                <label class="fw-bold small ms-1 mb-1 text-accent">Contraseña</label>
                <div class="input-group">
                    <!-- Inputs corregidos -->
                    <input type="password" name="password" id="passwordInput" class="form-control" placeholder="Ingrese su contraseña" required>
                    <button class="btn btn-outline-secondary border-secondary" type="button" onclick="togglePassword()">
                        <i class="bi bi-eye text-white" id="eyeIcon"></i>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn-access">ACCEDER AL PORTAL</button>
        </form>
    </div>

    <script>
        // Animación Splash Entrada
        window.addEventListener('load', () => {
            setTimeout(() => {
                const splash = document.getElementById('splash-login');
                splash.style.opacity = '0';
                setTimeout(() => { splash.style.display = 'none'; }, 500);
            }, 1500);
        });

        // CAMBIO REALIZADO: Lógica de espera de 3 segundos
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Detenemos el envío inmediato
            
            const splashExit = document.getElementById('splash-validando');
            splashExit.style.display = 'flex';
            
            // Aparece suavemente
            setTimeout(() => { splashExit.style.opacity = '1'; }, 10);

            // Esperamos 3 segundos y ENVIAMOS
            setTimeout(() => {
                this.submit(); // Envío real al servidor
            }, 3000);
        });

        function togglePassword() {
            const input = document.getElementById('passwordInput');
            const icon = document.getElementById('eyeIcon');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace('bi-eye', 'bi-eye-slash');
            } else {
                input.type = "password";
                icon.classList.replace('bi-eye-slash', 'bi-eye');
            }
        }
    </script>
</body>
</html>
